<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Web-Scraper - yk-dev-blog</title>
<meta name="description" content="웹 페이지에서 게시글 제목과 url을 parsing하고 토큰화하여 DB에 저장하고 사용자가 그 내역을 키워드로 검색할 수 있도록 구현했습니다. 이 어플리케이션은 하나 이상의 웹 페이지에서 가져온 다수의 게시글을 한번에 검색 할 수 있는게 특징입니다.">



<meta property="og:type" content="article">
<meta property="og:locale" content="ko">
<meta property="og:site_name" content="yk-dev-blog">
<meta property="og:title" content="Web-Scraper">
<meta property="og:url" content="https://midas123.github.io/2019/06/02/web-scraper.html">


  <meta property="og:description" content="웹 페이지에서 게시글 제목과 url을 parsing하고 토큰화하여 DB에 저장하고 사용자가 그 내역을 키워드로 검색할 수 있도록 구현했습니다. 이 어플리케이션은 하나 이상의 웹 페이지에서 가져온 다수의 게시글을 한번에 검색 할 수 있는게 특징입니다.">







  <meta property="article:published_time" content="2019-06-02T00:00:00+00:00">






<link rel="canonical" href="https://midas123.github.io/2019/06/02/web-scraper.html">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="yk-dev-blog Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
#scrollToTop {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 30px;
  z-index: 99;
  font-size: 14px;
  border: none;
  outline: none;
  background-color: black;
  color: white;
  cursor: pointer;
  padding: 15px;
  border-radius: 4px;
}


</style>


<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  


<button onclick="topFunction()" id="scrollToTop" title="Go to top">맨 위로</button>

<script>
  // When the user scrolls down 20px from the top of the document, show the button
  window.onscroll = function() {scrollFunction()};
  
  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      document.getElementById("scrollToTop").style.display = "block";
    } else {
      document.getElementById("scrollToTop").style.display = "none";
    }
  }
  
  // When the user clicks on the button, scroll to the top of the document
  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }
  </script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138663237-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138663237-1');
</script>

<!-- flex slider -->
<link rel="stylesheet" href="/assets/slider/flexslider.css" type="text/css">
<script src="https://code.jquery.com/jquery-1.6.2.js"integrity="sha256-pXKSYZ0U64y9kjvenyjPmUrGarxI98l1t2kyj/M73ck="crossorigin="anonymous"></script>
<script src="/assets/slider/jquery.flexslider.js"></script>
<script src="/assets/slider/jquery.flexslider-min.js"></script>

<style>
@font-face {
 font-family: 'flexslider-icon';
 src: url(/assets/slider/fonts/flexslider-icon.eot);
 src: url(/assets/slider/fonts/flexslider-icon.woff) format('woff'),
      url(/assets/slider/fonts/flexslider-icon.ttf) format('truetype');
}

</style>
<script type="text/javascript" charset="utf-8">
  $(window).load(function() {
    $('.flexslider').flexslider({
      animation: "fade",
      directionNav: true,
      slideshowSpeed: 5000,
      animationSpeed: 600,
      touch: true
    });
  });
</script>

<!-- flex slider end -->

    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<!-- end custom head snippets -->

  </head>
  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">yk-dev-blog</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/" >Archive</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



  
  <div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="http://midas123.tistory.com/" rel="nofollow noopener noreferrer"><i class="fab fa-blogger" aria-hidden="true"></i> Tistory Blog</a></li>
          
        
          
            <li><a href="https://github.com/midas123" rel="nofollow noopener noreferrer"><i class="fab fa-git-square" aria-hidden="true"></i> Github</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">토글 메뉴</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">MENU</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/year-archive/" class="">최근 포스트</a></li>
          
            
            

            
            

            <li><a href="/#all-tags" class="">모든 태그</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  
</div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Web-Scraper">
    <meta itemprop="description" content="웹 페이지에서 게시글 제목과 url을 parsing하고 토큰화하여 DB에 저장하고 사용자가 그 내역을 키워드로 검색할 수 있도록 구현했습니다. 이 어플리케이션은 하나 이상의 웹 페이지에서 가져온 다수의 게시글을 한번에 검색 할 수 있는게 특징입니다.">
    <meta itemprop="datePublished" content="June 02, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Web-Scraper
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#개발환경">개발환경</a></li>
  <li><a href="#erd">ERD</a></li>
  <li><a href="#클래스-구조">클래스 구조</a></li>
  <li><a href="#flow-chart">FLOW CHART</a></li>
  <li><a href="#사용자-화면">사용자 화면</a></li>
  <li><a href="#사용-기술">사용 기술</a>
    <ul>
      <li><a href="#jsoup-java-library">jsoup-JAVA-library</a></li>
      <li><a href="#tokenization">Tokenization</a></li>
      <li><a href="#추상-클래스">추상 클래스</a></li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <p>웹 페이지에서 게시글 제목과 url을 parsing하고 토큰화하여 DB에 저장하고 사용자가 그 내역을 키워드로 검색할 수 있도록 구현했습니다. 이 어플리케이션은 하나 이상의 웹 페이지에서 가져온 다수의 게시글을 한번에 검색 할 수 있는게 특징입니다.</p>

<p>jsoup 라이브러리를 사용하였으며 사이트 마다 URL 형태가 다르기 때문에 웹 페이지를 parsing하는 메서드의 코드는 조금씩 달라야 했습니다. 그래서 WebScraper 추상 클래스를 상속 받고 메서드를 오버라이드해서 웹 페이지의 URL 구조의 맞게 parsing하도록 구현했습니다.</p>

<p>테이블은 items와 itemindex 2개로 구성했습니다. items에서는 게시글 제목과 URL을 저장하고 itemindex 테이블은 게시글 제목을 문자열로 토큰화하여 별도로 저장합니다. 사용자가 검색한 키워드를 토큰 테이블(itemindex)에서 매칭하고 참조키를 이용해서 items 테이블에서 게시글과 URL을 찾아 사용자에게 출력합니다.</p>

<p><a href="https://github.com/midas123/yk-toy-project">프로젝트-github-링크</a></p>

<p><br /></p>

<h2 id="개발환경">개발환경</h2>

<ul>
  <li>springboot</li>
  <li>jpa - hibernate</li>
  <li>gradle</li>
  <li>maria-db(구글 클라우드)</li>
</ul>

<p><br /></p>

<h2 id="erd">ERD</h2>

<p><img src="https://midas123.github.io\assets\images\post\0602\web-scraper_20190604_13_59.jpg" alt="" class="center-image" /></p>

<p><br /></p>

<h2 id="클래스-구조">클래스 구조</h2>

<p>엔티티 - Items, ItemIndexes</p>

<p>서비스 - ItemService, WebScrapService</p>

<p>추상 클래스 - WebScraper</p>

<p>DAO - ItemIndexRepository, ItemRepository</p>

<p>DTO - ItemRequestDto</p>

<p><img src="https://midas123.github.io\assets\images\post\0602\web-scraper-classes.jpg" alt="" class="center-image" /></p>

<p><br /></p>

<h2 id="flow-chart">FLOW CHART</h2>

<p><img src="https://midas123.github.io\assets\images\post\0602\web-scraper-flow.png" alt="" class="center-image" /></p>

<p><br /></p>

<h2 id="사용자-화면">사용자 화면</h2>

<p>‘java regular expression’ 키워드로 검색한 결과 입니다.</p>

<p><img src="https://midas123.github.io\assets\images\post\0602\web-scraper-page.jpg" alt="" class="center-image" /></p>

<p><br /></p>

<h2 id="사용-기술">사용 기술</h2>

<h3 id="jsoup-java-library">jsoup-JAVA-library</h3>

<p>jsoup 자바 라이브러리를 이용하여 웹 페이지를 parsing하고 글 제목과 URL을 담고 있는 html 엘리먼트를 추출했습니다. 그리고 엘리먼트에서 특정 데이터를 꺼내기 위해서 자바 정규 표현식을 사용하였습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">Elements</span> <span class="nf">getCategoryNameAndLink</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">links</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Elements</span> <span class="n">categoryElements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Elements</span><span class="o">();</span>
		<span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">s:</span> <span class="n">links</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
				<span class="n">categoryElements</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"li a[href~=\\/(.)[/.*(?i)spring.*|.*(?i)java.*]]"</span><span class="o">);</span>
			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
				<span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">categoryElements</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="tokenization">Tokenization</h3>

<p>parsing한 html 엘리먼트의 url을 토큰화 했습니다. 예를 들어 url이 ‘https:// …../java/java-regular-expression/’ 일때 tokenizer() 메서드로 ‘java, regular, expression’의 문자열을 token으로 추출합니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">tokenizer</span><span class="o">(</span><span class="n">String</span> <span class="n">link</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">MalformedURLException</span> <span class="o">{</span>
		<span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">link</span><span class="o">).</span><span class="na">getPath</span><span class="o">();</span>
		<span class="n">String</span> <span class="n">token</span> <span class="o">=</span><span class="s">""</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">length</span><span class="o">()&gt;</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="na">replaceFirst</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">""</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"-"</span><span class="o">);</span>
			<span class="n">String</span><span class="o">[]</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">"-"</span><span class="o">);</span>
			
			<span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashSet</span> <span class="o">&lt;&gt;();</span> 
			<span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">str:</span> <span class="n">tokens</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
			<span class="o">}</span>
			
			<span class="n">tokens</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">set</span><span class="o">.</span><span class="na">size</span><span class="o">()]);</span>
			<span class="n">token</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">","</span><span class="o">,</span> <span class="n">tokens</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">token</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="추상-클래스">추상 클래스</h3>

<p>웹 사이트마다 URL 구조 약간씩 다르기 때문에 문자열로 parsing 하는 과정도 조금씩 달라야 했습니다. 그래서 구현해야 하는 추상 메서드를 포함한 WebScraper 추상클래스를 정의하고 자식 클래스에서 메서드를 작성했습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">WebScraper</span> <span class="o">{</span>
	<span class="kd">abstract</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">setLinks</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">);</span>
	
	<span class="kd">abstract</span> <span class="n">Elements</span> <span class="nf">getCategoryNameAndLink</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">links</span><span class="o">);</span>
	
	<span class="kd">abstract</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ItemRequestDto</span><span class="o">&gt;</span> <span class="nf">getArticleTitleAndLink</span><span class="o">(</span><span class="n">Elements</span> <span class="n">categoryLinks</span><span class="o">);</span>
	
	<span class="kd">abstract</span> <span class="n">String</span> <span class="nf">tokenizer</span><span class="o">(</span><span class="n">String</span> <span class="n">link</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">MalformedURLException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/gradle" class="page__taxonomy-item" rel="tag">gradle</a><span class="sep">, </span>
    
      
      
      <a href="/tags/hibernate" class="page__taxonomy-item" rel="tag">hibernate</a><span class="sep">, </span>
    
      
      
      <a href="/tags/jpa" class="page__taxonomy-item" rel="tag">jpa</a><span class="sep">, </span>
    
      
      
      <a href="/tags/jsoup" class="page__taxonomy-item" rel="tag">jsoup</a><span class="sep">, </span>
    
      
      
      <a href="/tags/maria-db" class="page__taxonomy-item" rel="tag">maria-db</a><span class="sep">, </span>
    
      
      
      <a href="/tags/springboot" class="page__taxonomy-item" rel="tag">springboot</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time datetime="2019-06-02T00:00:00+00:00">June 02, 2019</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/2019/05/15/ajax-file-upload.html" class="pagination--pager" title="ajax로 파일 업로드하기
">이전</a>
    
    
      <a href="/2019/07/09/springboot-REST-api-react.html" class="pagination--pager" title="개발 단계에서 springboot-react 연동
">다음</a>
    
  </nav>

    </div>

    
    <section id="disqus_thread">
    <script>
    
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://ykblog-2.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow" style="padding-top: 10px;">
   <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div> -->

<div class="page__footer-copyright">&copy; 2019 yk-dev-blog. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  








  </body>
</html>
