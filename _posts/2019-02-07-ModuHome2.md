---
  layout: single
  title: ModuHome2
---

## INDEX

- [JUNIT 테스트](#junit-테스트)
- [AWS EC2 인스턴스에 수동 배포](#aws-ec2-인스턴스에-수동-배포)
- [jenkins를 이용한 자동 빌드 및 배포환경 구성](#jenkins-자동-빌드-및-배포환경-구성)
- [MODUHOME2 COMMIT 내역](#moduhome2-commit)

<br><br>

## junit 테스트

### -기능에 대한 설명

장바구니 담기 기능을 junit 테스트로 확인했습니다. 이 기능에서 makeCart() 메서드가 가장 중요한 역할을 합니다.

makeCart() 메서드는 회원과 비회원을 구분하고 단품 또는 여러 개의 상품을 장바구니에 추가하는 기능을 합니다.
동일한 상품이 이미 장바구니에 있을 경우에는 수량을 변경 합니다. 장바구니는 회원은 DB에 저장되고 비회원은 세션에 됩니다. 

<br>

### -테스트 진행 과정 설명

상품이 이미 담겨있는 기존 장바구니에 ''장바구니 담기''로 새로운 상품을 추가할 경우 잘 동작하는지 확인하였습니다.
CartItem 클래스는 VO 객체로 상품 번호, 상품 분류번호, 상품 수량을 Map 형태로 저장합니다.

CartServiceImplTest 클래스의 setup() 메서드에서 CartItem 객체에 값을 저장합니다. 그리고 testMakeCartInventory() 메서드에서 makeCart() 메서드를 실행하고 리턴한 값(장바구니)이 예상 값과 동일한지 확인합니다. 

<br>

*-CartItem 클래스*

```java
import java.util.HashMap;
import java.util.Map;

public class CartItem {
	private String GOODS_NUMBER;
	private String GOODS_KIND_NUMBER;
	private String CART_AMOUNT;
	private Map<String, Object> Item = new HashMap<>();
	
	public CartItem(String GOODS_KIND_NUMBER, String CART_AMOUNT, String GOODS_NUMBER) {
		this.GOODS_NUMBER = GOODS_NUMBER;
		this.GOODS_KIND_NUMBER = GOODS_KIND_NUMBER;
		this.CART_AMOUNT = CART_AMOUNT;
	}
	
	public Map<String, Object> makeItem(){
		Item.put("GOODS_NUMBER", getGOODS_NUMBER());
		Item.put("CART_AMOUNT", getCART_AMOUNT());
		Item.put("GOODS_KIND_NUMBER", getGOODS_KIND_NUMBER());
		return Item;
	}
	
	//get, set메서드 생략
```

<br>

*-CartServiceImplTest 테스트 클래스*

```java
import static org.junit.Assert.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import org.junit.Before;
import org.junit.Test;


public class CartServiceImplTest {
	private List<Map<String, Object>> BeforeCart; //이전 세션 장바구니
	private List<Map<String, Object>> expectedCart; //장바구니 담기 후 세션 장바구니
	private Map<String, Object> newGoods; //장바구니에 새로 추가될 상품
	private CartItem item; //장바구니 상품
	private CartItem item2;
	private CartItem item3;
	
	@Before
	public void setup() {
		BeforeCart = new ArrayList<>(); //상품 추가 전 장바구니
		item = new CartItem("344", "3", "500");
		item2 = new CartItem("345", "5", "500");
		BeforeCart.add((Map<String, Object>) item.makeItem());
		BeforeCart.add((Map<String, Object>) item2.makeItem());
		
		expectedCart = new ArrayList<>(); //상품 추가 후 장바구니(추가 상품은 아래에)
		item = new CartItem("344", "5", "500");//상품 수량 2증가
		item2 = new CartItem("345", "9", "500");//상품 수량 4증가
		item3 = new CartItem("350", "1", "500");//추가 된 새로운 상품
		expectedCart.add((Map<String, Object>) item.makeItem());
		expectedCart.add((Map<String, Object>) item2.makeItem());
		expectedCart.add((Map<String, Object>) item3.makeItem());
		
		//비회원 세션 장바구니 담기(추가) 요청 데이터
		String goodsNum = "500"; //상품번호
		String[] ea = {"2", "4", "1"};//상품 수량
		String[] kinds = {"344", "345", "350"}; //상품 종류 번호
		newGoods = new HashMap<>();
		newGoods.put("ea[]", ea);
		newGoods.put("GOODS_KIND_NUMBER[]",kinds );
		newGoods.put("GOODS_NUMBER", goodsNum);
		newGoods.put("cartSession", BeforeCart); //makeCart() 실행 전 이전 장바구니 저장
	}
	
	@Test
	public void testMakeCartInventory() throws Exception {
			CartServiceImpl cartService = new CartServiceImpl();
			List<Map<String, Object>> AfterMakeCart = cartService.makeCart(newGoods);//추가 상품으로 장바구니 생성
			
			//makeCart() 실행 후 실제로 리턴한 장바구니와 미리 세팅한 상품 추가 후 장바구니(expectedCart 객체)의 값이 동일한지 확인
			assertTrue(expectedCart.get(0).values().toString().equals(AfterMakeCart.get(0).values().toString()));
			assertTrue(expectedCart.get(1).values().toString().equals(AfterMakeCart.get(1).values().toString()));
			assertTrue(expectedCart.get(2).values().toString().equals(AfterMakeCart.get(2).values().toString()));
	}

}
```

<br><br>

## 프로젝트를 aws ec2 인스턴스에 수동 배포

<br>

**-목표**

로컬 환경에서 실행하던 프로젝트를 원격 접속이 가능하게 세팅하면서 aws 클라우드 서비스를 접해볼 의도로  이 과정을 진행하게 되었습니다. 리눅스 CLI 환경에서 명령어 사용에 익숙해질 수 있었습니다. 

<br>

**-진행 과정**

1. aws 에서 EC2 인스턴스 생성(Ubuntu 16.04.5)

2. EC2 인스턴스 보안그룹 설정에서 port 설정

3. 윈도우 환경에서 Putty로 SSH접속

4. 터미널에서 우분투 업데이트 후 톰캣 서버 설치

5. 이클립스에서 war 파일 생성

6. FileZilla를 이용해서 톰캣 서버 경로에 war 파일 업로드 

7. 톰캣이 경로에 있는 프로젝트를 자동으로 배포한다.  

<br><br>

## jenkins 자동 빌드 및 배포 환경 구성

위 방법은 프로젝트에 변동사항이 생길 때마다 수동으로 배포를 반복해야 하는 단점이 있었습니다. 그래서 jenkins와 docker를 사용해서 한 개의 EC2 인스턴스에서 자동 빌드 및 배포 환경을 구성하게 되었습니다. 

과정을 개인 블로그에 직접 정리하면서 진행했습니다.



[Docker에 톰캣 설치 및 설정](https://midas123.tistory.com/232)

[Docker 가상환경에서 jenkins/tomcat으로 자동 배포 구성](https://midas123.tistory.com/228)

<br>

-**목표**

Docker, jenkins를 사용해서 CI(Continuous Integration) 환경을 구성

<br>

**-진행 과정**

1. 윈도우 환경에서 Putty로 EC2 인스턴스에 SSH 접속

2. 터미널에서 Docker 설치 

3. Docker에서 jenkins, tomcat 이미지를 pull하고 각각 컨테이너로 실행

4. 웹브라우저에서 jenkins 실행 후 프로젝트 설정에서 자동 빌드 및 배포 설정

5. github에서 Webhooks으로 프로젝트에 commit 이벤트 발생시 jenkins로 post 요청 설정

<br>

**결과물:**
제출한 이력서에 URL 첨부

<br><br>

## moduhome2 commit

Moduhome2 프로젝트의 commit 내역 입니다. 주로 기존 기능을 개선하거나 오류를 수정하고 코드 정리하였습니다.

<br>

<div style="height: 1000px; width: 700; overflow: auto;">
    <img src="{{ site.url }}{{ site.baseurl }}\assets\images\post\MODUHOME2\md-commit2.jpg">
</div>
